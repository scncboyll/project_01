<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>支付页面</title>
    <link rel="stylesheet" href="../../css/base.css">
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/index.css">
    <link rel="stylesheet" href="../../fonts/iconfont/iconfont.css">  
    <link rel="stylesheet" href="../../css/goodscar/goodspay.css">
    <script src="../../js/Common.js"></script>
    <script src="../../js/jquery-1.12.4.js"></script>

</head>
<body>
    <!-- 快捷导航 -->
    <div class="shortcut">
        <div class="wrapper">
            <ul>
                <li></li>
                <li><a href="Home?DashboardID=7">首页</a></li>
                <li><a href="Home?DashboardID=15">购物车</a></li>
                <li><a href="Home?DashboardID=16">留言板</a></li>
                <li><a href="Home?DashboardID=19">个人中心</a></li>
                <li><a href="Home?DashboardID=0">退出登录</a></li>
            </ul>
        </div>
    </div>


    <!-- 头部 -->
    <div class="header wrapper">
        <div class="logo">
            <h1><a href="#"></a></h1>
        </div>
        <div class="nav" id="nav_list">
            <ul>
                <!-- <li><a href="Home?DashboardID=7">首页</a></li> -->
                <li><a href="Home?DashboardID=7">首页</a></li>
                <li><a href="#">小吃零食</a></li>
                <li><a href="#">生活用品</a></li>
                <li><a href="#">文具用品</a></li>
                <li><a href="#">新鲜水果</a></li>
                <li><a href="#">电子产品</a></li>
            </ul>
        </div>
    
        <!-- 搜索框 -->
        <div class="search_nav">
            <div class="result-list">
                <ul>
                    <li><a href="#">辣条</a></li>
                    <li><a href="#">洁柔卫生纸</a></li>
                    <li><a href="#">小太阳吹分机</a></li>
                    <li><a href="#">小米手机</a></li>
                    <li><a href="#">华为手机</a></li>
                    <li><a href="#">飘柔洗发水</a></li>
                    <li><a href="#">李宁卫衣</a></li>
                    <li><a href="#">香蕉</a></li>
                </ul>
            </div>
        </div>
        <div class="search">
            <input type="text" placeholder="搜一搜">
            <!-- 定位 放大镜 -->
            <span></span>
        </div>
        <div class="car">
            <span>2</span>
        </div>
    
    </div>

    <div class="wrapper" style="background-color: #f7f7f8">
            <!-- 主体内容：滑动查看 -->
    <div class="main" >
        <!-- 用户信息 -->
        <div class="pannel user_msg">
            <div class="location">
                <i class="iconfont icon-location"></i>
            </div>
            <div class="user">
                <div class="top">
                    <h5></h5>
                    <p>18500667882</p>
                </div>
                <div class="bottom">银川市  西夏区  中关村软件园   信息科技大厦1号楼410#   
                </div>
            </div>
            <div class="more">
                <i class="iconfont icon-more"></i>
            </div>
        </div>
        <!-- 用户信息 -->
        <!-- 商品 -->
        <div class="good_list">
            <!-- <div class="pannel goods">
                <div class="pic">
                    <a href="#"><img src="../../uploads/2.jpg" alt="" style="width: 85px; height: 85px;"></a>
                </div>
                <div class="info">
                    <h5>康尔贝 非接触式红外体温仪
                        领券立减30元 婴儿级材质 测温…</h5>
                    <p><span>粉色</span> <span>红外体温计</span></p>
                    <div class="price">
                        <span class="red">¥ <i>266</i> </span>
                        <span>¥299</span>
                    </div>
                </div>
                <div class="count">
                    <i class="iconfont icon-x"></i>
                    <span>1</span>
                </div>
            </div> -->
            
        </div>

        <!-- 商品 -->
        <!-- 其他 -->
        <section class="pannel rest">
            <div>
                <h5>配送方式</h5>
                <p>顺丰快递</p>
            </div>
            <div>
                <h5>卖家备注</h5>
                <p>希望可以尽快发货</p>
            </div>
            <div>
                <h5>支付方式</h5>
                <p>银行卡： <span>6214536549875436951</span></p>
            </div>
        </section>

        <!-- 价格 -->
        <section class="pannel jiage">
            <div>
                <h5>商品总结</h5>
                <p>￥ <span></span></p>
            </div>
            <div>
                <h5>运费</h5>
                <p>￥0.00</p>
            </div>
            <div>
                <h5>折扣</h5>
                <p id="zekou">￥- <span></span></p>
            </div>
        </section>
        <!-- 价格 -->
        <!-- 其他 -->
    </div>
    <!-- 主体内容：滑动查看 -->
    <!-- 底部支付：固定定位 -->
    <div class="pay">
        <div class="left">
            合计：<span class="red">￥<i></i></span>
        </div>
        <div class="right">
            <a href="javascript:;">去支付</a>
        </div>
    </div>
    <!-- 底部支付：固定定位 -->
</div>

    <script>
        //导航栏线上登录用户的姓名
        const ykname = document.querySelector('.shortcut .wrapper li:first-child')
        const ykyuname = localStorage.getItem('ykyname');
        ykname.innerHTML = `<a href="javascript:;"><i class="iconfont icon-user" style="font-size: 14px;">${ykyuname}</a>`
        $('.user .top h5').html(ykyuname)
        //退出登录删除本地用户名
        const removeName = document.querySelector('.shortcut .wrapper li:last-child')
        removeName.addEventListener('click', function () {
            localStorage.removeItem('xtx-uname')
        })

        $(function(){
            //获取购物车中的数据
            let url = "/API";

            //向APICommand传递一个AdminIndex参数
            let parameter = {
                APICommand: "Admingoods",
            }
            getAPICommandData(url, parameter).then(data => {
                let userList = data.Data;
                        
                let datanew = []
                $.each(userList, function (i, val) {
                    if (val.delstatus === '1') {
                        datanew.push(val)
                    }
                })
                str = ''
                let sum = 0
                for (let i = 0; i < datanew.length; i++) {
                    sum += datanew[i].price * datanew[i].num
                    str += `
                <div class="pannel goods">
                <div class="pic">
                    <a href="#"><img src="../../uploads/${datanew[i].goodid}.jpg" alt="" style="width: 85px; height: 85px;"></a>
                </div>
                <div class="info">  
                    <h5>${datanew[i].note}</h5>
                    <p><span>${datanew[i].goodname}</span></p>
                    <div class="price">
                        <span class="red">¥ <i>${(+datanew[i].price).toFixed(2)}</i> </span>
                        <span>${Math.ceil(+datanew[i].price * 1.3).toFixed(2)}</span>
                    </div>
                </div>
                <div class="count">
                    <i class="iconfont icon-x"></i>
                    <span>${datanew[i].num}</span>
                </div>
                </div>
                `
                }
                $('.jiage div p span').eq(0).text(sum.toFixed(2))
                $('.pay .left .red i').text(sum.toFixed(2) - sum*0.3)
                $('.good_list').html(str)
                $('.jiage #zekou span').text(sum * 0.3)

                $('.right').on('click', function () {
                    const goodspayinfo = localStorage.getItem('ykyname');
                    const tel = $('.user .top p').text()
                    const addr = $('.user .bottom').text()

                    let url = "/API";

                    let param = {
                        APICommand: "goodspayinfo",
                        Goodspayinfo: goodspayinfo,
                        Tel: tel,
                        Addr: addr
                    }
                    getAPICommandData(url, param).then(data => {
                        if (data.Data > 0) {
                            alert("支付成功");
                            localStorage.setItem('datanew', JSON.stringify(datanew))
                            setInterval(function () {
                                location.href = 'Home?DashboardID=19'
                            }, 1000)
                        } else {
                            alert(data);
                        }
                    })
                })


            })





            
        })
    </script>
</body>
</html>